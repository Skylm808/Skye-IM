# User æ¨¡å—å‰ç«¯å¯¹æ¥æ–‡æ¡£

## ğŸ“‹ ç›®å½•

- [æ¦‚è¿°](#æ¦‚è¿°)
- [ç”¨æˆ·èµ„æ–™æ¥å£](#ç”¨æˆ·èµ„æ–™æ¥å£)
- [ç”¨æˆ·æœç´¢æ¥å£](#ç”¨æˆ·æœç´¢æ¥å£)
- [æ•°æ®å­—æ®µè¯´æ˜](#æ•°æ®å­—æ®µè¯´æ˜)
- [é”™è¯¯ç è¯´æ˜](#é”™è¯¯ç è¯´æ˜)

---

## æ¦‚è¿°

### Base URL

```
http://localhost:8080
```

### é€šç”¨è¯·æ±‚å¤´

```
Authorization: Bearer <access_token>
Content-Type: application/json
```

### æ¥å£æ€»è§ˆ

| æ¨¡å— | æ¥å£æ•° | è¯´æ˜ |
|------|-------|------|
| ç”¨æˆ·èµ„æ–™ | 3ä¸ª | è·å–ã€æ›´æ–°èµ„æ–™ã€æ›´æ–°å¤´åƒ |
| ç”¨æˆ·æœç´¢ | 3ä¸ª | ç²¾ç¡®æœç´¢ã€å…¨å±€æœç´¢ã€è·å–æŒ‡å®šç”¨æˆ· |

**å…±è®¡**: 6ä¸ªAPIæ¥å£

---

## ç”¨æˆ·èµ„æ–™æ¥å£

### 1. è·å–å½“å‰ç”¨æˆ·èµ„æ–™

**åœºæ™¯**: è·å–ç™»å½•ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯

**ç«¯ç‚¹**: `GET /api/v1/user/profile`

**è¯·æ±‚å¤´**:
```
Authorization: Bearer <access_token>
```

**æˆåŠŸå“åº”** (200):
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "user": {
      "id": 1001,
      "username": "skylm808",
      "nickname": "å¤©ä¸´",
      "avatar": "https://cdn.example.com/avatars/1001.jpg",
      "signature": "çƒ­çˆ±æŠ€æœ¯çš„ç¨‹åºå‘˜",
      "gender": 1,
      "region": "åŒ—äº¬",
      "phone": "13800138000",
      "email": "skylm808@example.com",
      "status": 1,
      "createdAt": 1736683200
    }
  }
}
```

**æ³¨æ„äº‹é¡¹**:
- è¿”å›å½“å‰ç™»å½•ç”¨æˆ·çš„å®Œæ•´ä¿¡æ¯
- `gender`: 0-æœªçŸ¥ 1-ç”· 2-å¥³
- `status`: 1-æ­£å¸¸ 0-ç¦ç”¨

---

### 2. æ›´æ–°ç”¨æˆ·èµ„æ–™

**åœºæ™¯**: ä¿®æ”¹æ˜µç§°ã€ç­¾åç­‰ä¸ªäººä¿¡æ¯

**ç«¯ç‚¹**: `PUT /api/v1/user/profile`

**è¯·æ±‚ä½“**:
```json
{
  "nickname": "æ–°æ˜µç§°",
  "signature": "æ–°çš„ä¸ªæ€§ç­¾å",
  "gender": 1,
  "region": "ä¸Šæµ·",
  "phone": "13900139000"
}
```

**å­—æ®µè¯´æ˜**:
| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|-----|------|
| nickname | string | å¦ | æ˜µç§° |
| avatar | string | å¦ | å¤´åƒURL |
| signature | string | å¦ | ä¸ªæ€§ç­¾å |
| gender | int64 | å¦ | æ€§åˆ«ï¼š0-æœªçŸ¥ 1-ç”· 2-å¥³ |
| region | string | å¦ | åœ°åŒº |
| phone | string | å¦ | æ‰‹æœºå· |

**æˆåŠŸå“åº”** (200):
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "user": {
      "id": 1001,
      "username": "skylm808",
      "nickname": "æ–°æ˜µç§°",
      "avatar": "https://cdn.example.com/avatars/1001.jpg",
      "signature": "æ–°çš„ä¸ªæ€§ç­¾å",
      "gender": 1,
      "region": "ä¸Šæµ·",
      "phone": "13900139000",
      "email": "skylm808@example.com",
      "status": 1,
      "createdAt": 1736683200
    }
  }
}
```

**é”™è¯¯å“åº”**:
```json
{
  "code": 40001,
  "message": "æ‰‹æœºå·å·²è¢«ä½¿ç”¨"
}
```

**æ³¨æ„äº‹é¡¹**:
- æ‰€æœ‰å­—æ®µéƒ½æ˜¯å¯é€‰çš„ï¼Œåªä¼ éœ€è¦ä¿®æ”¹çš„å­—æ®µ
- æ‰‹æœºå·éœ€è¦å”¯ä¸€ï¼Œä¸èƒ½ä¸å…¶ä»–ç”¨æˆ·é‡å¤
- `username` ä¸å¯ä¿®æ”¹

---

### 3. æ›´æ–°å¤´åƒ

**åœºæ™¯**: å•ç‹¬æ›´æ–°ç”¨æˆ·å¤´åƒ

**ç«¯ç‚¹**: `PUT /api/v1/user/avatar`

**è¯·æ±‚ä½“**:
```json
{
  "avatar": "https://cdn.example.com/avatars/new.jpg"
}
```

**å­—æ®µè¯´æ˜**:
| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|-----|------|
| avatar | string | æ˜¯ | å¤´åƒURL |

**æˆåŠŸå“åº”** (200):
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "user": {
      "id": 1001,
      "username": "skylm808",
      "nickname": "å¤©ä¸´",
      "avatar": "https://cdn.example.com/avatars/new.jpg",
      ...
    }
  }
}
```

**æ³¨æ„äº‹é¡¹**:
- å¤´åƒURLéœ€è¦å…ˆé€šè¿‡ `/api/v1/upload/avatar` ä¸Šä¼ æ–‡ä»¶è·å–
- å»ºè®®ä½¿ç”¨ CDN åŠ é€Ÿå¤´åƒè®¿é—®

---

## ç”¨æˆ·æœç´¢æ¥å£

### 1. æœç´¢ç”¨æˆ·ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰

**åœºæ™¯**: é€šè¿‡ç”¨æˆ·åã€æ‰‹æœºå·ã€é‚®ç®±ç²¾ç¡®æœç´¢ç”¨æˆ·ï¼ˆç”¨äºæ·»åŠ å¥½å‹ï¼‰

**ç«¯ç‚¹**: `GET /api/v1/user/search`

**æŸ¥è¯¢å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|-----|------|
| keyword | string | æ˜¯ | æœç´¢å…³é”®è¯ï¼ˆç”¨æˆ·å/æ‰‹æœºå·/é‚®ç®±ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹**:
```
# é€šè¿‡ç”¨æˆ·åæœç´¢
GET /api/v1/user/search?keyword=skylm808

# é€šè¿‡æ‰‹æœºå·æœç´¢
GET /api/v1/user/search?keyword=13800138000

# é€šè¿‡é‚®ç®±æœç´¢
GET /api/v1/user/search?keyword=skylm808@example.com
```

**æˆåŠŸå“åº”** (200):
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "users": [
      {
        "id": 1001,
        "username": "skylm808",
        "nickname": "å¤©ä¸´",
        "avatar": "https://cdn.example.com/avatars/1001.jpg",
        "signature": "çƒ­çˆ±æŠ€æœ¯çš„ç¨‹åºå‘˜",
        "gender": 1,
        "region": "åŒ—äº¬",
        "phone": "138****8000",
        "email": "sky****@example.com",
        "status": 1,
        "createdAt": 1736683200
      }
    ],
    "total": 1
  }
}
```

**æ³¨æ„äº‹é¡¹**:
- **ç²¾ç¡®åŒ¹é…**ï¼š`username`ã€`phone`ã€`email` å®Œå…¨åŒ¹é…
- æ‰‹æœºå·å’Œé‚®ç®±ä¼šè„±æ•æ˜¾ç¤ºï¼ˆä¿æŠ¤éšç§ï¼‰
- å¦‚æœæ²¡æœ‰åŒ¹é…ç»“æœï¼Œè¿”å›ç©ºæ•°ç»„

---

### 2. å…¨å±€æ¨¡ç³Šæœç´¢

**åœºæ™¯**: æ¨¡ç³Šæœç´¢ç”¨æˆ·å’Œç¾¤ç»„ï¼ˆæœç´¢æ åŠŸèƒ½ï¼‰

**ç«¯ç‚¹**: `GET /api/v1/user/search/global`

**æŸ¥è¯¢å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|-----|------|
| keyword | string | æ˜¯ | æœç´¢å…³é”®è¯ |

**è¯·æ±‚ç¤ºä¾‹**:
```
GET /api/v1/user/search/global?keyword=æŠ€æœ¯
```

**æˆåŠŸå“åº”** (200):
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "users": [
      {
        "id": 1001,
        "username": "tech_lover",
        "nickname": "æŠ€æœ¯çˆ±å¥½è€…",
        "avatar": "https://cdn.example.com/avatars/1001.jpg",
        "signature": "çƒ­çˆ±æŠ€æœ¯",
        "gender": 1,
        "region": "åŒ—äº¬",
        "phone": "",
        "email": "",
        "status": 1,
        "createdAt": 1736683200
      }
    ],
    "groups": [
      {
        "groupId": "g_20260113_001",
        "name": "æŠ€æœ¯äº¤æµç¾¤",
        "avatar": "https://cdn.example.com/groups/001.jpg",
        "description": "åˆ†äº«æŠ€æœ¯å¿ƒå¾—"
      }
    ]
  }
}
```

**æ³¨æ„äº‹é¡¹**:
- **æ¨¡ç³ŠåŒ¹é…**ï¼šåŒ¹é…ç”¨æˆ·æ˜µç§°ã€ç¾¤ç»„åç§°
- è¿”å›ç”¨æˆ·å’Œç¾¤ç»„ä¸¤ç±»ç»“æœ
- ä¸è¿”å›æ‰‹æœºå·å’Œé‚®ç®±ï¼ˆéšç§ä¿æŠ¤ï¼‰

---

### 3. è·å–æŒ‡å®šç”¨æˆ·ä¿¡æ¯

**åœºæ™¯**: æŸ¥çœ‹å…¶ä»–ç”¨æˆ·çš„å…¬å¼€èµ„æ–™

**ç«¯ç‚¹**: `GET /api/v1/user/:id`

**è·¯å¾„å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|-----|------|
| id | int64 | æ˜¯ | ç”¨æˆ·ID |

**è¯·æ±‚ç¤ºä¾‹**:
```
GET /api/v1/user/1002
```

**æˆåŠŸå“åº”** (200):
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "user": {
      "id": 1002,
      "username": "lisi",
      "nickname": "æå››",
      "avatar": "https://cdn.example.com/avatars/1002.jpg",
      "signature": "Hello World",
      "gender": 1,
      "region": "ä¸Šæµ·",
      "phone": "",
      "email": "",
      "status": 1,
      "createdAt": 1736683100
    }
  }
}
```

**æ³¨æ„äº‹é¡¹**:
- ä¸è¿”å›æ‰‹æœºå·å’Œé‚®ç®±ï¼ˆéšç§ä¿æŠ¤ï¼‰
- å¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œè¿”å› 404

**é”™è¯¯å“åº”** (404):
```json
{
  "code": 40004,
  "message": "ç”¨æˆ·ä¸å­˜åœ¨"
}
```

---

## æ•°æ®å­—æ®µè¯´æ˜

### UserInfo å­—æ®µ

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | int64 | ç”¨æˆ·ID |
| username | string | ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼Œä¸å¯ä¿®æ”¹ï¼‰ |
| nickname | string | æ˜µç§° |
| avatar | string | å¤´åƒURL |
| signature | string | ä¸ªæ€§ç­¾å |
| gender | int64 | æ€§åˆ«ï¼š0-æœªçŸ¥ 1-ç”· 2-å¥³ |
| region | string | åœ°åŒº |
| phone | string | æ‰‹æœºå·ï¼ˆéšç§å­—æ®µï¼‰ |
| email | string | é‚®ç®±ï¼ˆéšç§å­—æ®µï¼‰ |
| status | int64 | çŠ¶æ€ï¼š1-æ­£å¸¸ 0-ç¦ç”¨ |
| createdAt | int64 | åˆ›å»ºæ—¶é—´ï¼ˆUnixæ—¶é—´æˆ³ï¼Œç§’ï¼‰ |

### æ€§åˆ«è¯´æ˜

| gender | è¯´æ˜ |
|--------|------|
| 0 | æœªçŸ¥/ä¿å¯† |
| 1 | ç”· |
| 2 | å¥³ |

### ç”¨æˆ·çŠ¶æ€è¯´æ˜

| status | è¯´æ˜ |
|--------|------|
| 1 | æ­£å¸¸ |
| 0 | ç¦ç”¨ï¼ˆå°å·ï¼‰ |

---

## é”™è¯¯ç è¯´æ˜

| é”™è¯¯ç  | è¯´æ˜ |
|-------|------|
| 0 | æˆåŠŸ |
| 40001 | å‚æ•°é”™è¯¯ |
| 40002 | æ‰‹æœºå·æ ¼å¼é”™è¯¯ |
| 40003 | é‚®ç®±æ ¼å¼é”™è¯¯ |
| 40004 | ç”¨æˆ·ä¸å­˜åœ¨ |
| 40005 | æ‰‹æœºå·å·²è¢«ä½¿ç”¨ |
| 40006 | é‚®ç®±å·²è¢«ä½¿ç”¨ |
| 40007 | ç”¨æˆ·å·²è¢«ç¦ç”¨ |

---

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•ä¸Šä¼ å¤´åƒï¼Ÿ

**A**: 
1. å…ˆè°ƒç”¨ä¸Šä¼ æ¥å£ï¼š`POST /api/v1/upload/avatar`
2. ä¸Šä¼ æˆåŠŸåå¾—åˆ°å¤´åƒURL
3. è°ƒç”¨æ›´æ–°å¤´åƒæ¥å£ï¼š`PUT /api/v1/user/avatar`

### Q2: æ‰‹æœºå·å’Œé‚®ç®±ä»€ä¹ˆæ—¶å€™ä¼šè„±æ•ï¼Ÿ

**A**: 
- **è·å–è‡ªå·±çš„èµ„æ–™**ï¼šå®Œæ•´æ˜¾ç¤º
- **æœç´¢å…¶ä»–ç”¨æˆ·**ï¼šè„±æ•æ˜¾ç¤ºï¼ˆå¦‚ `138****8000`ï¼‰
- **æŸ¥çœ‹å…¶ä»–ç”¨æˆ·èµ„æ–™**ï¼šä¸æ˜¾ç¤ºï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰

### Q3: ç”¨æˆ·åå¯ä»¥ä¿®æ”¹å—ï¼Ÿ

**A**: ä¸å¯ä»¥ã€‚`username` æ˜¯ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ï¼Œæ³¨å†Œåä¸å¯ä¿®æ”¹ã€‚å¯ä»¥ä¿®æ”¹ `nickname`ï¼ˆæ˜µç§°ï¼‰ã€‚

### Q4: å…¨å±€æœç´¢å’Œç²¾ç¡®æœç´¢æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**A**: 
- **ç²¾ç¡®æœç´¢** (`/user/search`)ï¼šç”¨äºæ·»åŠ å¥½å‹ï¼Œç²¾ç¡®åŒ¹é…ç”¨æˆ·å/æ‰‹æœºå·/é‚®ç®±
- **å…¨å±€æœç´¢** (`/user/search/global`)ï¼šç”¨äºæœç´¢æ ï¼Œæ¨¡ç³ŠåŒ¹é…æ˜µç§°å’Œç¾¤ç»„å

### Q5: å¦‚ä½•åˆ¤æ–­æ‰‹æœºå·æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼Ÿ

**A**: 
å‰ç«¯éªŒè¯ï¼š
```javascript
const phoneRegex = /^1[3-9]\d{9}$/;
if (!phoneRegex.test(phone)) {
    alert('æ‰‹æœºå·æ ¼å¼é”™è¯¯');
}
```

### Q6: æ€§åˆ«å¯ä»¥ä¸å¡«å—ï¼Ÿ

**A**: å¯ä»¥ã€‚`gender=0` è¡¨ç¤ºæœªçŸ¥/ä¿å¯†ã€‚

---

## ä½¿ç”¨å»ºè®®

### 1. èµ„æ–™æ›´æ–°

```
å»ºè®®æ‰¹é‡æ›´æ–°ï¼Œä¸è¦é¢‘ç¹è¯·æ±‚ï¼š

// âŒ ä¸æ¨èï¼šæ¯ä¸ªå­—æ®µå•ç‹¬æ›´æ–°
updateNickname();
updateSignature();
updateGender();

// âœ… æ¨èï¼šä¸€æ¬¡æ€§æ›´æ–°
updateProfile({
    nickname,
    signature,
    gender
});
```

### 2. å¤´åƒä¸Šä¼ 

```
1. é€‰æ‹©å›¾ç‰‡
2. å‹ç¼©å›¾ç‰‡ï¼ˆå‰ç«¯å‹ç¼©ï¼Œå‡å°‘ä¸Šä¼ æ—¶é—´ï¼‰
3. ä¸Šä¼ åˆ° Upload æœåŠ¡
4. æ›´æ–°å¤´åƒURL
```

### 3. æœç´¢ç”¨æˆ·

```
æ·»åŠ å¥½å‹åœºæ™¯ï¼š
ç”¨æˆ·è¾“å…¥å®Œæ•´ç”¨æˆ·å/æ‰‹æœºå·/é‚®ç®± â†’ ç²¾ç¡®æœç´¢ â†’ æ‰¾åˆ°ç›®æ ‡ç”¨æˆ·

å…¨å±€æœç´¢åœºæ™¯ï¼š
ç”¨æˆ·è¾“å…¥å…³é”®è¯ â†’ æ¨¡ç³Šæœç´¢ â†’ å±•ç¤ºç”¨æˆ·å’Œç¾¤ç»„åˆ—è¡¨
```

---

**æ–‡æ¡£ç»´æŠ¤**: Skylm  
**æœ€åæ›´æ–°**: 2026-01-13  
**ç›¸å…³æ–‡æ¡£**: [User æ¶æ„è®¾è®¡](../ARCHITECTURE.md)
