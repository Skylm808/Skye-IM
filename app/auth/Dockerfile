# å¤šé˜¶æ®µæ„å»ºï¼šå…ˆç¼–è¯‘ï¼Œå†è¿è¡?
FROM golang:1.25-alpine AS builder

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶ go.mod å’?go.sum
COPY go.mod go.sum ./

# ä¸‹è½½ä¾èµ–
RUN go mod download

# å¤åˆ¶æ•´ä¸ªé¡¹ç›®
COPY . .

# ç¼–è¯‘ Auth æœåŠ¡
WORKDIR /app/app/auth
RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o auth auth.go

# è¿è¡Œé˜¶æ®µï¼šä½¿ç”¨æ›´å°çš„é•œåƒ
FROM alpine:latest

# å®‰è£… ca-certificatesï¼ˆHTTPS éœ€è¦ï¼‰
RUN apk --no-cache add ca-certificates tzdata

# è®¾ç½®æ—¶åŒºä¸ºä¸Šæµ?
ENV TZ=Asia/Shanghai

WORKDIR /app

# ä»æ„å»ºé˜¶æ®µå¤åˆ¶äºŒè¿›åˆ¶æ–‡ä»¶
COPY --from=builder /app/app/auth/auth .
COPY --from=builder /app/app/auth/etc ./etc

# æš´éœ²ç«¯å£
EXPOSE 10001

# è¿è¡ŒæœåŠ¡
CMD ["./auth", "-f", "etc/auth-api-docker.yaml"]

