# User å¾®æœåŠ¡æ¶æ„ä¸æµç¨‹è®²

## ä¸€ã€æœåŠ¡æ¦‚è¿°

User æœåŠ¡æ˜¯ SkyeIM å³æ—¶é€šè®¯ç³»ç»Ÿçš„**ç”¨æˆ·ç®¡ç†å¾®æœåŠ¡**ï¼Œè´Ÿè´£ç”¨æˆ·èµ„æ–™çš„æŸ¥è¯¢å’Œæ›´æ–°ï¼Œä»¥åŠç”¨æˆ·æœç´¢åŠŸèƒ½ã€‚

**æ³¨æ„**: ç”¨æˆ·çš„æ³¨å†Œã€ç™»å½•ã€é‰´æƒç­‰åŠŸèƒ½åœ¨ **Auth æœåŠ¡**ä¸­å®ç°ï¼ŒUser æœåŠ¡ä¸“æ³¨äºç”¨æˆ·èµ„æ–™ç®¡ç†ã€‚

### æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯é€‰å‹ | ç”¨é€” |
|------|---------|------|
| æ¡†æ¶ | go-zero | å¾®æœåŠ¡æ¡†æ¶ |
| æ•°æ®åº“ | MySQL | ç”¨æˆ·æ•°æ®æŒä¹…åŒ– |
| ç¼“å­˜ | Redis | Model ç¼“å­˜ |
| é€šä¿¡ | gRPC + HTTP | RPC å†…éƒ¨è°ƒç”¨ + HTTP å¯¹å¤–æ¥å£ |

---

## äºŒã€ç›®å½•ç»“æ„

```
app/user/
â”œâ”€â”€ api/                          # HTTP API å±‚
â”‚   â”œâ”€â”€ user.api                  # API å®šä¹‰æ–‡ä»¶
â”‚   â”œâ”€â”€ USER_APIæ–‡æ¡£.md          # å‰ç«¯å¯¹æ¥æ–‡æ¡£
â”‚   â””â”€â”€ internal/
â”‚       â”œâ”€â”€ handler/              # HTTP å¤„ç†å™¨
â”‚       â”‚   â”œâ”€â”€ profile/          # èµ„æ–™ç®¡ç†
â”‚       â”‚   â””â”€â”€ search/           # æœç´¢åŠŸèƒ½
â”‚       â””â”€â”€ logic/                # ä¸šåŠ¡é€»è¾‘å±‚
â”‚           â”œâ”€â”€ profile/
â”‚           â””â”€â”€ search/
â””â”€â”€ rpc/                          # gRPC æœåŠ¡å±‚
    â””â”€â”€ internal/
        â””â”€â”€ logic/                # RPC ä¸šåŠ¡é€»è¾‘
```

**æ³¨æ„**: User è¡¨å®šä¹‰åœ¨ `app/auth/model/user.sql`

---

## ä¸‰ã€æ•°æ®åº“è®¾è®¡

### 3.1 ç”¨æˆ·è¡¨ (user)

```sql
CREATE TABLE `user` (
    `id` bigint unsigned NOT NULL AUTO_INCREMENT,
    `username` varchar(64) NOT NULL COMMENT 'ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰',
    `phone` varchar(20) DEFAULT NULL COMMENT 'æ‰‹æœºå·ï¼ˆå”¯ä¸€ï¼‰',
    `email` varchar(128) DEFAULT NULL COMMENT 'é‚®ç®±ï¼ˆå”¯ä¸€ï¼‰',
    `password` varchar(128) NOT NULL COMMENT 'å¯†ç ï¼ˆbcryptåŠ å¯†ï¼‰',
    `nickname` varchar(64) DEFAULT '' COMMENT 'æ˜µç§°',
    `avatar` varchar(512) DEFAULT '' COMMENT 'å¤´åƒURL',
    `signature` varchar(255) DEFAULT '' COMMENT 'ä¸ªæ€§ç­¾å',
    `gender` tinyint unsigned NOT NULL DEFAULT 0 COMMENT 'æ€§åˆ«ï¼š0-æœªçŸ¥ 1-ç”· 2-å¥³',
    `region` varchar(64) DEFAULT '' COMMENT 'åœ°åŒº',
    `status` tinyint unsigned NOT NULL DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š1-æ­£å¸¸ 0-ç¦ç”¨',
    `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_username` (`username`),
    UNIQUE KEY `uk_phone` (`phone`),
    UNIQUE KEY `uk_email` (`email`),
    KEY `idx_status` (`status`),
    KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

**è®¾è®¡è¦ç‚¹**ï¼š

**1. å”¯ä¸€çº¦æŸ**:
- `uk_username`: ç”¨æˆ·åå…¨å±€å”¯ä¸€
- `uk_phone`: æ‰‹æœºå·å…¨å±€å”¯ä¸€
- `uk_email`: é‚®ç®±å…¨å±€å”¯ä¸€

**ç”¨é€”**: é˜²æ­¢é‡å¤æ³¨å†Œï¼Œæ”¯æŒå¤šç§ç™»å½•æ–¹å¼

**2. å¯†ç å­—æ®µ**:
- ä½¿ç”¨ bcrypt åŠ å¯†å­˜å‚¨
- ä¸å¯é€†ï¼Œå®‰å…¨æ€§é«˜

**3. èµ„æ–™å­—æ®µ**:
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| nickname | varchar(64) | æ˜µç§°ï¼ˆå¯é‡å¤ï¼‰|
| avatar | varchar(512) | å¤´åƒURL |
| signature | varchar(255) | ä¸ªæ€§ç­¾å |
| gender | tinyint | 0-æœªçŸ¥ 1-ç”· 2-å¥³ |
| region | varchar(64) | åœ°åŒº |

**4. çŠ¶æ€å­—æ®µ**:
- `status=1`: æ­£å¸¸
- `status=0`: ç¦ç”¨ï¼ˆå°å·ï¼‰

**5. ç´¢å¼•ä¼˜åŒ–**:
| ç´¢å¼• | ç”¨é€” |
|------|------|
| `uk_username` | ç™»å½•ã€æœç´¢ |
| `uk_phone` | æ‰‹æœºå·ç™»å½•ã€æœç´¢ |
| `uk_email` | é‚®ç®±ç™»å½•ã€æœç´¢ |
| `idx_status` | è¿‡æ»¤ç¦ç”¨ç”¨æˆ· |

---

## å››ã€æ ¸å¿ƒæµç¨‹

### 4.1 è·å–ç”¨æˆ·èµ„æ–™æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    GET /api/v1/user/profile    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  Handler    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Authorization: Bearer token   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â–¼
                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚   Logic     â”‚
                                            â”‚ GetProfile  â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â”‚ JWTä¸­æå–userId
                                                   â–¼
                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚ User RPC    â”‚
                                            â”‚ GetUserInfo â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â–¼
                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚ User Model  â”‚
                                            â”‚ (å¸¦ç¼“å­˜)    â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                              â”‚              â”‚
                    â–¼                              â–¼              â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ æŸ¥ Redis    â”‚              â”‚ æœªå‘½ä¸­      â”‚ â”‚ æŸ¥ MySQL    â”‚
             â”‚ ç¼“å­˜        â”‚              â”‚             â”‚ â”‚             â”‚
             â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                                            â”‚
                    â”‚ å‘½ä¸­                                        â”‚
                    â–¼                                            â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ è¿”å›ç”¨æˆ·ä¿¡æ¯â”‚                              â”‚ å†™å…¥ç¼“å­˜    â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                                 â”‚
                                                                 â–¼
                                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                          â”‚ è¿”å›ç”¨æˆ·ä¿¡æ¯â”‚
                                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ç‚¹**ï¼š
- ğŸ” userId ä» JWT Token ä¸­æå–
- ğŸš€ Model å±‚è‡ªåŠ¨ç¼“å­˜ï¼Œæå‡æ€§èƒ½
- ğŸ“ è¿”å›å®Œæ•´ç”¨æˆ·ä¿¡æ¯ï¼ˆåŒ…æ‹¬æ‰‹æœºå·ã€é‚®ç®±ï¼‰

---

### 4.2 æ›´æ–°ç”¨æˆ·èµ„æ–™æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    PUT /api/v1/user/profile    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  Handler    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  {nickname, signature, ...}    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â–¼
                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚   Logic     â”‚
                                            â”‚UpdateProfileâ”‚
                                            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                                  â”‚              â”‚
                â–¼                                  â–¼              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ å‚æ•°éªŒè¯    â”‚              â”‚ æ‰‹æœºå·æ£€æŸ¥  â”‚ â”‚ é‚®ç®±æ£€æŸ¥    â”‚
         â”‚             â”‚              â”‚ (å”¯ä¸€æ€§)    â”‚ â”‚ (å”¯ä¸€æ€§)    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚              â”‚
                                             â”‚              â”‚
                                             â–¼              â–¼
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚ æŸ¥è¯¢æ•°æ®åº“æ£€æŸ¥é‡å¤      â”‚
                                      â”‚ WHERE phone = ? AND id != ? â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â”‚ ä¸é‡å¤
                                             â–¼
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚ æ›´æ–°æ•°æ®åº“  â”‚
                                      â”‚ UPDATE user â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚ æ¸…é™¤ç¼“å­˜    â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚ è¿”å›æ–°èµ„æ–™  â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ç‚¹**ï¼š
- âœ… **å”¯ä¸€æ€§æ£€æŸ¥**ï¼šæ‰‹æœºå·å’Œé‚®ç®±éœ€è¦æ£€æŸ¥æ˜¯å¦è¢«å…¶ä»–ç”¨æˆ·ä½¿ç”¨
- ğŸ”’ **æ›´æ–°åæ¸…ç¼“å­˜**ï¼šä¿è¯ç¼“å­˜ä¸€è‡´æ€§
- ğŸ“ **è¿”å›æœ€æ–°æ•°æ®**ï¼šæ›´æ–°æˆåŠŸåè¿”å›å®Œæ•´ç”¨æˆ·ä¿¡æ¯

---

### 4.3 æœç´¢ç”¨æˆ·æµç¨‹

**ç²¾ç¡®æœç´¢ï¼ˆç”¨äºæ·»åŠ å¥½å‹ï¼‰**:
```
ç”¨æˆ·è¾“å…¥å®Œæ•´ç”¨æˆ·å/æ‰‹æœºå·/é‚®ç®±
    â†“
GET /api/v1/user/search?keyword=skylm808
    â†“
æŸ¥è¯¢æ•°æ®åº“
WHERE username = 'skylm808' 
   OR phone = '13800138000' 
   OR email = 'skylm@example.com'
    â†“
æ‰¾åˆ°ç”¨æˆ·
    â†“
è„±æ•å¤„ç†
phone: 138****8000
email: sky****@example.com
    â†“
è¿”å›ç»“æœ
```

**å…¨å±€æ¨¡ç³Šæœç´¢ï¼ˆæœç´¢æ ï¼‰**:
```
ç”¨æˆ·è¾“å…¥å…³é”®è¯
    â†“
GET /api/v1/user/search/global?keyword=æŠ€æœ¯
    â†“
æŸ¥è¯¢ç”¨æˆ·
WHERE nickname LIKE '%æŠ€æœ¯%'
    â†“
æŸ¥è¯¢ç¾¤ç»„ï¼ˆè°ƒç”¨ Group RPCï¼‰
WHERE name LIKE '%æŠ€æœ¯%'
    â†“
åˆå¹¶ç»“æœ
    â†“
è¿”å› {users: [...], groups: [...]}
```

---

## äº”ã€æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 5.1 éšç§ä¿æŠ¤æœºåˆ¶

**åœºæ™¯ä¸€ï¼šè·å–è‡ªå·±çš„èµ„æ–™**
```go
func GetOwnProfile(userId int64) (*UserInfo, error) {
    user := getUserById(userId)
    // è¿”å›å®Œæ•´ä¿¡æ¯
    return user, nil
}
```

**åœºæ™¯äºŒï¼šæœç´¢å…¶ä»–ç”¨æˆ·**
```go
func SearchUser(keyword string) ([]*UserInfo, error) {
    users := searchByKeyword(keyword)
    
    // è„±æ•å¤„ç†
    for _, user := range users {
        user.Phone = maskPhone(user.Phone)  // 138****8000
        user.Email = maskEmail(user.Email)  // sky****@example.com
    }
    
    return users, nil
}

func maskPhone(phone string) string {
    if len(phone) != 11 {
        return phone
    }
    return phone[:3] + "****" + phone[7:]
}

func maskEmail(email string) string {
    parts := strings.Split(email, "@")
    if len(parts) != 2 {
        return email
    }
    
    prefix := parts[0]
    if len(prefix) > 3 {
        prefix = prefix[:3] + "****"
    }
    
    return prefix + "@" + parts[1]
}
```

**åœºæ™¯ä¸‰ï¼šæŸ¥çœ‹å…¶ä»–ç”¨æˆ·èµ„æ–™**
```go
func GetUserInfo(userId int64, targetUserId int64) (*UserInfo, error) {
    user := getUserById(targetUserId)
    
    // ä¸è¿”å›éšç§å­—æ®µ
    user.Phone = ""
    user.Email = ""
    
    return user, nil
}
```

---

### 5.2 Model ç¼“å­˜æœºåˆ¶

**go-zero è‡ªåŠ¨ç¼“å­˜**:
```go
// æŸ¥è¯¢æ—¶è‡ªåŠ¨ç¼“å­˜
func (m *defaultUserModel) FindOne(ctx context.Context, id int64) (*User, error) {
    key := fmt.Sprintf("cache:user:id:%d", id)
    
    // 1. å…ˆæŸ¥ Redis
    var user User
    err := m.QueryRowCtx(ctx, &user, key, func(ctx, conn, v) error {
        // 2. Redis æœªå‘½ä¸­ï¼ŒæŸ¥ MySQL
        return conn.QueryRowCtx(ctx, v, 
            "SELECT * FROM user WHERE id = ?", id)
    })
    
    return &user, err
}

// æ›´æ–°æ—¶è‡ªåŠ¨æ¸…é™¤ç¼“å­˜
func (m *defaultUserModel) Update(ctx context.Context, data *User) error {
    key := fmt.Sprintf("cache:user:id:%d", data.Id)
    
    _, err := m.ExecCtx(ctx, func(ctx, conn) (sql.Result, error) {
        return conn.ExecCtx(ctx, "UPDATE user SET ... WHERE id = ?", ...)
    }, key)  // è‡ªåŠ¨åˆ é™¤ç¼“å­˜
    
    return err
}
```

---

### 5.3 å”¯ä¸€æ€§æ£€æŸ¥

**æ›´æ–°æ‰‹æœºå·æ—¶æ£€æŸ¥**:
```go
func UpdateProfile(userId int64, phone string) error {
    // æ£€æŸ¥æ‰‹æœºå·æ˜¯å¦è¢«å…¶ä»–ç”¨æˆ·ä½¿ç”¨
    var existUser User
    err := db.Where("phone = ? AND id != ?", phone, userId).First(&existUser).Error
    
    if err == nil {
        return errors.New("æ‰‹æœºå·å·²è¢«ä½¿ç”¨")
    }
    
    // æ›´æ–°
    return db.Model(&User{}).Where("id = ?", userId).Update("phone", phone).Error
}
```

---

## å…­ã€æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 6.1 ç¼“å­˜ä¼˜åŒ–

**1. Model çº§ç¼“å­˜**ï¼ˆå·²å®ç°ï¼‰:
- go-zero è‡ªåŠ¨ç¼“å­˜
- ç¼“å­˜æ—¶é—´ï¼š1 å°æ—¶

**2. æœç´¢ç»“æœç¼“å­˜**ï¼ˆå¯é€‰ï¼‰:
```go
func SearchUser(keyword string) ([]*UserInfo, error) {
    cacheKey := fmt.Sprintf("search:user:%s", keyword)
    
    // å…ˆæŸ¥ç¼“å­˜
    if cache.Exists(cacheKey) {
        return cache.Get(cacheKey), nil
    }
    
    // æŸ¥æ•°æ®åº“
    users := db.Where("username = ? OR phone = ? OR email = ?", 
                      keyword, keyword, keyword).Find(&User{})
    
    // å†™å…¥ç¼“å­˜ï¼ˆ5åˆ†é’Ÿï¼‰
    cache.Set(cacheKey, users, 5*time.Minute)
    
    return users, nil
}
```

---

### 6.2 æ•°æ®åº“ä¼˜åŒ–

**1. ç´¢å¼•ä¼˜åŒ–**ï¼ˆå·²å®ç°ï¼‰:
```sql
UNIQUE KEY `uk_username` (`username`),
UNIQUE KEY `uk_phone` (`phone`),
UNIQUE KEY `uk_email` (`email`)
```

**2. æŸ¥è¯¢ä¼˜åŒ–**:
```sql
-- âœ… ä½¿ç”¨å”¯ä¸€ç´¢å¼•
SELECT * FROM user WHERE username = 'skylm808';  -- å‘½ä¸­ç´¢å¼•

-- âŒ é¿å…æ¨¡ç³ŠæŸ¥è¯¢ï¼ˆæœç´¢é™¤å¤–ï¼‰
SELECT * FROM user WHERE username LIKE '%skylm%';  -- å…¨è¡¨æ‰«æ
```

---

## ä¸ƒã€å¸¸è§é—®é¢˜

### Q1: User æœåŠ¡å’Œ Auth æœåŠ¡çš„åŒºåˆ«ï¼Ÿ

**A**: 

**Auth æœåŠ¡**ï¼š
- ç”¨æˆ·æ³¨å†Œã€ç™»å½•
- JWT Token é¢å‘å’Œåˆ·æ–°
- å¯†ç æ‰¾å›ã€ä¿®æ”¹å¯†ç 

**User æœåŠ¡**ï¼š
- ç”¨æˆ·èµ„æ–™æŸ¥è¯¢å’Œæ›´æ–°
- ç”¨æˆ·æœç´¢

**ä¸ºä»€ä¹ˆåˆ†å¼€**ï¼Ÿ
- âœ… èŒè´£åˆ†ç¦»ï¼šè®¤è¯å’Œèµ„æ–™ç®¡ç†æ˜¯ä¸åŒå…³æ³¨ç‚¹
- âœ… å®‰å…¨æ€§ï¼šå¯†ç ç›¸å…³æ“ä½œç‹¬ç«‹ç®¡ç†
- âœ… æ‰©å±•æ€§ï¼šå¯ä»¥ç‹¬ç«‹æ‰©å±•

---

### Q2: ä¸ºä»€ä¹ˆä¸èƒ½ä¿®æ”¹ç”¨æˆ·åï¼Ÿ

**A**: 
- `username` æ˜¯ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†
- ç”¨æˆ·åä¿®æ”¹ä¼šå¯¼è‡´ï¼š
  - å¥½å‹å…³ç³»éœ€è¦åŒæ­¥æ›´æ–°
  - å†å²æ¶ˆæ¯å‘é€è€…éœ€è¦æ›´æ–°
  - ç¾¤æˆå‘˜è®°å½•éœ€è¦æ›´æ–°
- å…è®¸ä¿®æ”¹ `nickname`ï¼ˆæ˜µç§°ï¼‰æ¥å®ç°"æ”¹å"éœ€æ±‚

---

### Q3: å¦‚ä½•å®ç°ç”¨æˆ·å°å·ï¼Ÿ

**A**: 
```go
// å°å·
func BanUser(userId int64) error {
    return db.Model(&User{}).
        Where("id = ?", userId).
        Update("status", 0).Error
}

// è§£å°
func UnbanUser(userId int64) error {
    return db.Model(&User{}).
        Where("id = ?", userId).
        Update("status", 1).Error
}

// ç™»å½•æ—¶æ£€æŸ¥
func Login(username, password string) (*User, error) {
    user := getUserByUsername(username)
    
    if user.Status == 0 {
        return nil, errors.New("ç”¨æˆ·å·²è¢«ç¦ç”¨")
    }
    
    // éªŒè¯å¯†ç ...
}
```

---

## å…«ã€æ€»ç»“

User å¾®æœåŠ¡é‡‡ç”¨**åˆ†å±‚æ¶æ„**ï¼š

1. **API å±‚**ï¼šHTTP æ¥å£ï¼ˆèµ„æ–™ã€æœç´¢ï¼‰
2. **RPC å±‚**ï¼šå†…éƒ¨æœåŠ¡è°ƒç”¨
3. **Model å±‚**ï¼šæ•°æ®è®¿é—®ï¼ˆå¸¦ç¼“å­˜ï¼‰

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- ğŸ“Š ä¸ Auth æœåŠ¡èŒè´£åˆ†ç¦»
- ğŸ” éšç§ä¿æŠ¤ï¼ˆè„±æ•ã€æƒé™æ§åˆ¶ï¼‰
- ğŸš€ Model ç¼“å­˜æå‡æ€§èƒ½
- âœ… å”¯ä¸€æ€§çº¦æŸä¿è¯æ•°æ®ä¸€è‡´æ€§
- ğŸ” æ”¯æŒç²¾ç¡®æœç´¢å’Œæ¨¡ç³Šæœç´¢
- ğŸ¯ ç®€å•é«˜æ•ˆï¼Œæ˜“äºç»´æŠ¤

---

**æ–‡æ¡£ä½œè€…**: Skylm  
**æœ€åæ›´æ–°**: 2026-01-13  
**ç›¸å…³æ–‡æ¡£**: [User API æ–‡æ¡£](./api/USER_APIæ–‡æ¡£.md)
