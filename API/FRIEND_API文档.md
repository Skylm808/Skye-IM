# Friend 模块前端对接文档

## 📋 目录

- [接口概览](#接口概览)
- [公共说明](#公共说明)
- [好友申请接口](#好友申请接口)
- [好友关系接口](#好友关系接口)
- [黑名单接口](#黑名单接口)
- [错误码说明](#错误码说明)

---

## 接口概览

### 好友申请相关

| 接口名称 | 请求方式 | 接口路径 | 说明 |
|---------|---------|---------|------|
| 发送好友申请 | POST | `/api/v1/friend/request` | 向用户发送好友申请 |
| 获取收到的申请 | GET | `/api/v1/friend/request/received` | 查看收到的好友申请列表 |
| 获取发出的申请 | GET | `/api/v1/friend/request/sent` | 查看自己发出的申请列表 |
| 处理好友申请 | PUT | `/api/v1/friend/request/:requestId` | 同意或拒绝好友申请 |

### 好友关系相关

| 接口名称 | 请求方式 | 接口路径 | 说明 |
|---------|---------|---------|------|
| 获取好友列表 | GET | `/api/v1/friend/list` | 分页获取好友列表 |
| 删除好友 | DELETE | `/api/v1/friend/:friendId` | 删除指定好友 |
| 更新好友备注 | PUT | `/api/v1/friend/:friendId/remark` | 修改好友备注 |
| 检查好友关系 | GET | `/api/v1/friend/:friendId/check` | 检查是否为好友 |

### 黑名单相关

| 接口名称 | 请求方式 | 接口路径 | 说明 |
|---------|---------|---------|------|
| 设置黑名单 | POST | `/api/v1/friend/blacklist` | 拉黑或取消拉黑 |
| 获取黑名单列表 | GET | `/api/v1/friend/blacklist` | 查看黑名单列表 |

---

## 公共说明

### 基础地址

```
开发环境: http://localhost:8080
生产环境: https://your-domain.com
```

### 请求头设置

所有接口都需要认证：

```http
Content-Type: application/json
Authorization: Bearer {accessToken}
```

### 响应格式

```json
{
  "code": 0,
  "message": "success",
  "data": {}
}
```

### 分页参数

需要分页的接口统一使用以下参数：

| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|-------|------|-----|-------|------|
| page | int64 | 否 | 1 | 页码 |
| pageSize | int64 | 否 | 20 | 每页数量 |

---

## 好友申请接口

### 1. 发送好友申请

向指定用户发送好友申请。

**接口地址**: `POST /api/v1/friend/request`

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| toUserId | int64 | 是 | 目标用户 ID |
| message | string | 否 | 申请留言 |

**请求示例**:

```json
{
  "toUserId": 1001,
  "message": "你好，我想加你为好友"
}
```

**响应示例**:

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "requestId": 123
  }
}
```

**注意事项**:
- 📝 留言长度建议不超过 100 字符
- ⚠️ 不能重复发送申请给同一用户
- ❌ 不能向自己发送申请
- ✅ 如果已是好友，会返回错误

---

### 2. 获取收到的好友申请列表

查看别人发给我的好友申请。

**接口地址**: `GET /api/v1/friend/request/received`

**请求参数**:

| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|-------|------|-----|-------|------|
| page | int64 | 否 | 1 | 页码 |
| pageSize | int64 | 否 | 20 | 每页数量 |

**请求示例**:

```
GET /api/v1/friend/request/received?page=1&pageSize=20
```

**响应示例**:

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 123,
        "fromUserId": 1001,
        "toUserId": 2001,
        "message": "你好，我想加你为好友",
        "status": 0,
        "createdAt": 1705132800
      }
    ],
    "total": 5
  }
}
```

**字段说明**:
- `status`: 申请状态
  - `0` - 待处理
  - `1` - 已同意
  - `2` - 已拒绝
- `createdAt`: Unix 时间戳（秒）

---

### 3. 获取发出的好友申请列表

查看我发出的好友申请及其处理状态。

**接口地址**: `GET /api/v1/friend/request/sent`

**请求参数**:

| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|-------|------|-----|-------|------|
| page | int64 | 否 | 1 | 页码 |
| pageSize | int64 | 否 | 20 | 每页数量 |

**请求示例**:

```
GET /api/v1/friend/request/sent?page=1&pageSize=20
```

**响应示例**:

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 124,
        "fromUserId": 2001,
        "toUserId": 1002,
        "message": "加个好友吧",
        "status": 0,
        "createdAt": 1705132900
      }
    ],
    "total": 3
  }
}
```

---

### 4. 处理好友申请

同意或拒绝好友申请。

**接口地址**: `PUT /api/v1/friend/request/:requestId`

**路径参数**:

| 参数名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| requestId | int64 | 是 | 申请 ID |

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| action | int64 | 是 | 操作类型：1-同意，2-拒绝 |

**请求示例**:

```json
{
  "action": 1
}
```

**响应示例**:

```json
{
  "code": 0,
  "message": "success",
  "data": {}
}
```

**注意事项**:
- ✅ 同意后双方自动成为好友
- 📢 建议通过 WebSocket 实时通知对方
- ⚠️ 只能处理发给自己的申请

---

## 好友关系接口

### 1. 获取好友列表

分页获取当前用户的好友列表。

**接口地址**: `GET /api/v1/friend/list`

**请求参数**:

| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|-------|------|-----|-------|------|
| page | int64 | 否 | 1 | 页码 |
| pageSize | int64 | 否 | 20 | 每页数量 |

**请求示例**:

```
GET /api/v1/friend/list?page=1&pageSize=20
```

**响应示例**:

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "friendId": 1001,
        "remark": "老王",
        "status": 1,
        "createdAt": 1705132800
      },
      {
        "id": 2,
        "friendId": 1002,
        "remark": "",
        "status": 1,
        "createdAt": 1705132900
      }
    ],
    "total": 25
  }
}
```

**字段说明**:
- `friendId`: 好友的用户 ID
- `remark`: 好友备注（为空表示未设置）
- `status`: 好友状态
  - `1` - 正常
  - `2` - 已拉黑

**注意事项**:
- 💡 建议前端配合用户服务接口获取好友详细信息（昵称、头像等）
- 🔍 可根据 `status` 字段过滤显示

---

### 2. 删除好友

删除指定好友关系。

**接口地址**: `DELETE /api/v1/friend/:friendId`

**路径参数**:

| 参数名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| friendId | int64 | 是 | 好友的用户 ID |

**无请求体**

**响应示例**:

```json
{
  "code": 0,
  "message": "success",
  "data": {}
}
```

**注意事项**:
- ⚠️ 删除后双方都不再是好友
- 🗑️ 删除是双向的（双方的好友列表都会移除）
- 💬 删除好友不会删除聊天记录

---

### 3. 更新好友备注

修改好友的备注名称。

**接口地址**: `PUT /api/v1/friend/:friendId/remark`

**路径参数**:

| 参数名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| friendId | int64 | 是 | 好友的用户 ID |

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| remark | string | 是 | 备注名称 |

**请求示例**:

```json
{
  "remark": "老王"
}
```

**响应示例**:

```json
{
  "code": 0,
  "message": "success",
  "data": {}
}
```

**注意事项**:
- 📝 备注长度建议 1-32 字符
- 💡 备注为空字符串表示清除备注
- 🔒 备注只对自己可见

---

### 4. 检查好友关系

检查指定用户是否为自己的好友。

**接口地址**: `GET /api/v1/friend/:friendId/check`

**路径参数**:

| 参数名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| friendId | int64 | 是 | 要检查的用户 ID |

**响应示例**:

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "isFriend": true,
    "status": 1
  }
}
```

**字段说明**:
- `isFriend`: 是否为好友
- `status`: 好友状态
  - `0` - 非好友
  - `1` - 正常好友
  - `2` - 已被拉黑

**使用场景**:
- 🔍 搜索用户后判断是否已是好友
- 💬 聊天界面判断关系状态
- 👥 查看用户资料时判断关系

---

## 黑名单接口

### 1. 设置黑名单

拉黑或取消拉黑指定用户。

**接口地址**: `POST /api/v1/friend/blacklist`

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| friendId | int64 | 是 | 目标用户 ID |
| isBlack | bool | 是 | true-拉黑，false-取消拉黑 |

**请求示例（拉黑）**:

```json
{
  "friendId": 1001,
  "isBlack": true
}
```

**请求示例（取消拉黑）**:

```json
{
  "friendId": 1001,
  "isBlack": false
}
```

**响应示例**:

```json
{
  "code": 0,
  "message": "success",
  "data": {}
}
```

**注意事项**:
- 🚫 拉黑后对方无法给你发送消息
- 📢 拉黑后好友关系仍然存在（status 变为 2）
- ✅ 可以重复拉黑/取消拉黑同一用户

---

### 2. 获取黑名单列表

查看自己的黑名单列表。

**接口地址**: `GET /api/v1/friend/blacklist`

**请求参数**:

| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|-------|------|-----|-------|------|
| page | int64 | 否 | 1 | 页码 |
| pageSize | int64 | 否 | 20 | 每页数量 |

**请求示例**:

```
GET /api/v1/friend/blacklist?page=1&pageSize=20
```

**响应示例**:

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 5,
        "friendId": 1003,
        "remark": "不想联系的人",
        "status": 2,
        "createdAt": 1705132800
      }
    ],
    "total": 1
  }
}
```

**字段说明**:
- 返回格式与好友列表相同
- `status` 固定为 `2`（黑名单状态）

---

## 错误码说明

| 错误码 | 说明 |
|-------|------|
| 0 | 成功 |
| 20001 | 参数错误 |
| 20002 | 用户不存在 |
| 20003 | 不能添加自己为好友 |
| 20004 | 已经是好友 |
| 20005 | 已发送过申请，请等待对方处理 |
| 20006 | 好友申请不存在 |
| 20007 | 无权处理此申请 |
| 20008 | 好友关系不存在 |
| 20009 | 已在黑名单中 |
| 20010 | 对方已将你拉黑 |

---

## 业务流程说明

### 添加好友完整流程

```
1. 用户 A 搜索用户 B
   ├─> 调用用户搜索接口
   └─> 调用检查好友关系接口

2. 用户 A 发送好友申请
   └─> POST /api/v1/friend/request

3. 用户 B 收到申请
   ├─> WebSocket 实时推送（已实现）
   └─> GET /api/v1/friend/request/received

4. 用户 B 处理申请
   ├─> PUT /api/v1/friend/request/:requestId
   └─> action=1（同意）或 action=2（拒绝）

5. 双方成为好友
   ├─> 用户 A 收到 WebSocket 通知
   └─> 双方可在好友列表看到对方
```

### 黑名单机制

```
拉黑用户后的影响：
- ✅ 好友关系仍然保留（status=2）
- ❌ 对方无法给你发送消息
- ❌ 对方看不到你的在线状态
- ✅ 你仍可以主动联系对方
- ✅ 可随时取消拉黑
```

---

## 常见问题

### Q1: 好友列表如何获取好友的详细信息？
**A**: 好友列表接口只返回好友 ID 和备注，需要额外调用用户服务的批量获取用户信息接口：
```
POST /api/v1/user/batch
Body: {"userIds": [1001, 1002, 1003]}
```

### Q2: 删除好友后聊天记录会消失吗？
**A**: 不会，聊天记录保留在消息服务中，删除好友只是移除好友关系。

### Q3: 如何判断对方是否在线？
**A**: 需要配合用户服务的在线状态接口，friend 服务不提供在线状态。

### Q4: 拉黑和删除好友的区别？
**A**: 
- **删除好友**: 双方不再是好友，需要重新申请
- **拉黑**: 好友关系保留，但对方无法给你发消息

### Q5: 好友申请有数量限制吗？
**A**: 建议前端做限流控制，避免用户短时间内发送大量申请。

---

## 更新日志

| 版本 | 日期 | 更新内容 |
|------|------|---------|
| v1.0 | 2026-01-13 | 初始版本，包含所有好友管理核心接口 |

---

**文档维护**: Skylm  
**最后更新**: 2026-01-13  
**相关文档**: [Friend 架构设计](../ARCHITECTURE.md)
